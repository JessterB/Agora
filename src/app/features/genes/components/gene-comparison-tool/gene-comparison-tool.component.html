<div #gct class="gct" (window:resize)="onResize()">
  <div class="gct-inner">
    <div class="gct-header">
      <div class="gct-header-inner">
        <div class="gct-header-left">
          <button
            (click)="filterPanel.toggle()"
            pTooltip="Filter genes by Nominations, Teams, Cohort, and more."
            tooltipPosition="right"
            tooltipStyleClass="tooltip"
          >
            <svg
              width="14"
              height="14"
              viewBox="0 0 14 14"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill="currentColor"
                d="M0,0.7C0,0.3,0.3,0,0.7,0h12.5C13.7,0,14,0.3,14,0.7v2.3c0,0.2-0.1,0.4-0.2,0.5L9,8.2v4.4 c0,0.3-0.2,0.6-0.6,0.7L5.9,14c-0.2,0.1-0.4,0-0.6-0.1c-0.2-0.1-0.3-0.3-0.3-0.6v-5L0.2,3.7C0.1,3.5,0,3.3,0,3.1V0.7z"
              />
            </svg>
            Filter Genes
          </button>
        </div>
        <div class="gct-header-middle">
          <h3 class="gct-heading">Gene Comparison Tool</h3>
        </div>
        <div class="gct-header-right">
          <button
            (click)="copyUrl()"
            pTooltip="Copy the URL that captures the table's current filters, sorting, and pinned genes."
            tooltipPosition="left"
            tooltipStyleClass="tooltip"
          >
            Share URL
          </button>
        </div>
      </div>
    </div>

    <gene-comparison-tool-filter-list
      #filterList
      [filters]="filters"
      (onChange)="setFilters($event)"
    ></gene-comparison-tool-filter-list>

    <div class="gct-body">
      <div class="gct-body-inner">
        <div class="gct-controls">
          <div class="gct-controls-inner">
            <div class="gct-controls-left">
              <div class="gene-label">DISPLAYED GENES</div>
              <div *ngIf="genesTable" class="gene-count">
                {{
                  (genesTable?._totalRecords || 0) +
                    (pinnedTable?.dataToRender?.length || 0)
                }}
              </div>
              <div class="gct-search">
                <svg
                  class="gct-search-icon"
                  width="13"
                  height="13"
                  viewBox="0 0 13 13"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M9.29102 8.1761H8.70383L8.49571 7.97541C9.22413 7.12807 9.66266 6.02802 9.66266 4.83133C9.66266 2.16295 7.49971 0 4.83133 0C2.16295 0 0 2.16295 0 4.83133C0 7.49971 2.16295 9.66266 4.83133 9.66266C6.02802 9.66266 7.12807 9.22413 7.97541 8.49571L8.1761 8.70383V9.29102L11.8925 13L13 11.8925L9.29102 8.1761ZM4.83133 8.1761C2.98056 8.1761 1.48656 6.6821 1.48656 4.83133C1.48656 2.98056 2.98056 1.48656 4.83133 1.48656C6.6821 1.48656 8.1761 2.98056 8.1761 4.83133C8.1761 6.6821 6.6821 8.1761 4.83133 8.1761Z"
                    fill="#C4C4C4"
                  />
                </svg>
                <input
                  type="text"
                  pInputText
                  (input)="onSearchInput($event)"
                  [value]="searchTerm"
                  placeholder="Search"
                />
                <button *ngIf="searchTerm" (click)="clearSearch()">
                  <svg
                    width="10"
                    height="10"
                    viewBox="0 0 10 10"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M1 9L9 1M1 1L9 9"
                      stroke="#C4C4C4"
                      stroke-width="2"
                    />
                  </svg>
                </button>
              </div>
            </div>
            <div class="gct-controls-right">
              <div class="gct-controls-right-top">
                <div class="gct-category-selector">
                  <div>
                    <p-dropdown
                      [options]="categories"
                      [(ngModel)]="category"
                      (onChange)="onCategoryChange()"
                    ></p-dropdown>
                  </div>
                  <div>
                    <overlay-panel-link
                      *ngIf="'RNA - Differential Expression' === category"
                      wikiId="618276"
                      icon="svg"
                    ></overlay-panel-link>
                    <overlay-panel-link
                      *ngIf="'Protein - Differential Expression' === category"
                      wikiId="618278"
                      icon="svg"
                    ></overlay-panel-link>
                  </div>
                </div>
                <div class="gct-significance-control">
                  <div>Hide insignificant</div>
                  <div>
                    <p-inputSwitch
                      [pTooltip]="
                        'When on, this will filter out all statistically insignificant results. Current significance cutoff is: ' +
                        significanceThreshold
                      "
                      tooltipPosition="left"
                      tooltipStyleClass="tooltip"
                      [(ngModel)]="significanceThresholdActive"
                      (onChange)="filter()"
                    ></p-inputSwitch>
                  </div>
                  <div>
                    <p-overlayPanel
                      #significanceOverlay
                      styleClass="gct-significance-control-panel"
                    >
                      <ng-template pTemplate>
                        <p class="gct-significance-control-panel-heading">
                          Statistical significance
                        </p>
                        <p>
                          Enter the p-value to use for the significance cutoff.
                        </p>
                        <input
                          type="number"
                          min="0"
                          max="1"
                          step="0.01"
                          [(ngModel)]="significanceThreshold"
                        />
                      </ng-template>
                    </p-overlayPanel>
                    <button
                      (click)="significanceOverlay.toggle($event)"
                      pTooltip="Edit significance cutoff value"
                      tooltipPosition="left"
                      tooltipStyleClass="tooltip"
                    >
                      <svg
                        width="18"
                        height="18"
                        viewBox="0 0 18 18"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M15.1917 9.81663C15.225 9.54996 15.25 9.28329 15.25 8.99996C15.25 8.71663 15.225 8.44996 15.1917 8.18329L16.95 6.80829C17.1083 6.68329 17.15 6.45829 17.05 6.27496L15.3833 3.39163C15.3083 3.25829 15.1667 3.18329 15.0167 3.18329C14.9667 3.18329 14.9167 3.19163 14.875 3.20829L12.8 4.04163C12.3667 3.70829 11.9 3.43329 11.3917 3.22496L11.075 1.01663C11.05 0.816626 10.875 0.666626 10.6667 0.666626H7.33332C7.12499 0.666626 6.94999 0.816626 6.92499 1.01663L6.60832 3.22496C6.09999 3.43329 5.63332 3.71663 5.19999 4.04163L3.12499 3.20829C3.07499 3.19163 3.02499 3.18329 2.97499 3.18329C2.83332 3.18329 2.69166 3.25829 2.61666 3.39163L0.949988 6.27496C0.841655 6.45829 0.891655 6.68329 1.04999 6.80829L2.80832 8.18329C2.77499 8.44996 2.74999 8.72496 2.74999 8.99996C2.74999 9.27496 2.77499 9.54996 2.80832 9.81663L1.04999 11.1916C0.891655 11.3166 0.849988 11.5416 0.949988 11.725L2.61666 14.6083C2.69166 14.7416 2.83332 14.8166 2.98332 14.8166C3.03332 14.8166 3.08332 14.8083 3.12499 14.7916L5.19999 13.9583C5.63332 14.2916 6.09999 14.5666 6.60832 14.775L6.92499 16.9833C6.94999 17.1833 7.12499 17.3333 7.33332 17.3333H10.6667C10.875 17.3333 11.05 17.1833 11.075 16.9833L11.3917 14.775C11.9 14.5666 12.3667 14.2833 12.8 13.9583L14.875 14.7916C14.925 14.8083 14.975 14.8166 15.025 14.8166C15.1667 14.8166 15.3083 14.7416 15.3833 14.6083L17.05 11.725C17.15 11.5416 17.1083 11.3166 16.95 11.1916L15.1917 9.81663ZM13.5417 8.39163C13.575 8.64996 13.5833 8.82496 13.5833 8.99996C13.5833 9.17496 13.5667 9.35829 13.5417 9.60829L13.425 10.55L14.1667 11.1333L15.0667 11.8333L14.4833 12.8416L13.425 12.4166L12.5583 12.0666L11.8083 12.6333C11.45 12.9 11.1083 13.1 10.7667 13.2416L9.88332 13.6L9.74999 14.5416L9.58332 15.6666H8.41666L8.25832 14.5416L8.12499 13.6L7.24165 13.2416C6.88332 13.0916 6.54999 12.9 6.21665 12.65L5.45832 12.0666L4.57499 12.425L3.51665 12.85L2.93332 11.8416L3.83332 11.1416L4.57499 10.5583L4.45832 9.61663C4.43332 9.35829 4.41665 9.16663 4.41665 8.99996C4.41665 8.83329 4.43332 8.64163 4.45832 8.39163L4.57499 7.44996L3.83332 6.86663L2.93332 6.16663L3.51665 5.15829L4.57499 5.58329L5.44165 5.93329L6.19165 5.36663C6.54999 5.09996 6.89165 4.89996 7.23332 4.75829L8.11665 4.39996L8.24999 3.45829L8.41666 2.33329H9.57499L9.73332 3.45829L9.86666 4.39996L10.75 4.75829C11.1083 4.90829 11.4417 5.09996 11.775 5.34996L12.5333 5.93329L13.4167 5.57496L14.475 5.14996L15.0583 6.15829L14.1667 6.86663L13.425 7.44996L13.5417 8.39163ZM8.99999 5.66663C7.15832 5.66663 5.66665 7.15829 5.66665 8.99996C5.66665 10.8416 7.15832 12.3333 8.99999 12.3333C10.8417 12.3333 12.3333 10.8416 12.3333 8.99996C12.3333 7.15829 10.8417 5.66663 8.99999 5.66663ZM8.99999 10.6666C8.08332 10.6666 7.33332 9.91663 7.33332 8.99996C7.33332 8.08329 8.08332 7.33329 8.99999 7.33329C9.91665 7.33329 10.6667 8.08329 10.6667 8.99996C10.6667 9.91663 9.91665 10.6666 8.99999 10.6666Z"
                          fill="#878E95"
                        />
                      </svg>
                    </button>
                  </div>
                </div>
              </div>

              <div class="gct-controls-right-bottom">
                <div class="gct-filter-label">{{ subCategoryLabel }}</div>
                <div class="gct-sub-category-selector">
                  <p-dropdown
                    [options]="subCategories"
                    [(ngModel)]="subCategory"
                    (onChange)="onSubCategoryChange()"
                  ></p-dropdown>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="gct-tables">
          <div class="gct-tables-inner">
            <p-table
              #headerTable
              id="table-header"
              (sortFunction)="setSort($event)"
              [customSort]="true"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th></th>
                  <th
                    *ngFor="let column of columns"
                    [pSortableColumn]="column"
                    [style]="{ width: columnWidth }"
                  >
                    <span
                      [pTooltip]="getTissueTooltipText(column)"
                      tooltipPosition="top"
                      tooltipStyleClass="tooltip"
                    >
                      {{ column }}
                    </span>
                    <p-sortIcon
                      [field]="column"
                      pTooltip="Sort by log2 fold change value"
                      tooltipPosition="top"
                      tooltipStyleClass="tooltip"
                    ></p-sortIcon>
                  </th>
                </tr>
              </ng-template>
            </p-table>

            <div *ngIf="pinnedCount > 0" class="table-divider table-divider-1">
              <div class="table-divider-inner">
                <div>Pinned Genes</div>
                <div class="csv-download-button">
                  <button (click)="downloadPinnedCsv()">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        opacity="0.3"
                        d="M13 9V5H11V11H9.83002L12 13.17L14.17 11H13V9Z"
                        fill="#3E61A9"
                      />
                      <path
                        d="M15 9V3H9V9H5L12 16L19 9H15ZM12 13.17L9.83 11H11V5H13V11H14.17L12 13.17ZM5 18H19V20H5V18Z"
                        fill="#3E61A9"
                      />
                    </svg>
                    Download as CSV
                  </button>
                </div>
                <div>
                  <button (click)="clearPinnedGenes()">Clear All</button>
                </div>
              </div>
            </div>
            <p-table
              #pinnedTable
              [value]="genes"
              [globalFilterFields]="['pinned']"
              [customSort]="true"
              (sortFunction)="sortCallback($event)"
              responsiveLayout="scroll"
            >
              <ng-template pTemplate="body" let-gene>
                <tr class="pinned">
                  <td>
                    <div class="gene-controls">
                      <div>
                        {{ gene.hgnc_symbol || gene.ensembl_gene_id }}
                        <ng-container *ngIf="gene.uniprotid">
                          ({{ gene.uniprotid }})
                        </ng-container>
                      </div>
                      <div>
                        <button
                          (click)="unpinGene(gene)"
                          pTooltip="Unpin this gene"
                          tooltipPosition="top"
                          tooltipStyleClass="tooltip"
                        >
                          <svg
                            width="12"
                            height="17"
                            viewBox="0 0 12 17"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path
                              d="M7.65 1.7V5.95C7.65 6.902 7.9645 7.786 8.5 8.5H3.4C3.9525 7.769 4.25 6.885 4.25 5.95V1.7H7.65ZM10.2 0H1.7C1.2325 0 0.85 0.3825 0.85 0.85C0.85 1.3175 1.2325 1.7 1.7 1.7H2.55V5.95C2.55 7.361 1.411 8.5 0 8.5V10.2H5.0745V16.15L5.9245 17L6.7745 16.15V10.2H11.9V8.5C10.489 8.5 9.35 7.361 9.35 5.95V1.7H10.2C10.6675 1.7 11.05 1.3175 11.05 0.85C11.05 0.3825 10.6675 0 10.2 0Z"
                              fill="white"
                            />
                          </svg>
                        </button>
                      </div>
                      <div>
                        <button
                          (click)="navigateToGene(gene)"
                          pTooltip="Open gene details page"
                          tooltipPosition="top"
                          tooltipStyleClass="tooltip"
                        >
                          <svg
                            width="15"
                            height="15"
                            viewBox="0 0 15 15"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path
                              d="M13.3333 13.3333H1.66667V1.66667H7.5V0H1.66667C0.741667 0 0 0.75 0 1.66667V13.3333C0 14.25 0.741667 15 1.66667 15H13.3333C14.25 15 15 14.25 15 13.3333V7.5H13.3333V13.3333ZM9.16667 0V1.66667H12.1583L3.96667 9.85833L5.14167 11.0333L13.3333 2.84167V5.83333H15V0H9.16667Z"
                              fill="white"
                            />
                          </svg>
                        </button>
                      </div>
                    </div>
                  </td>
                  <td
                    *ngFor="let column of columns"
                    [style]="{ width: columnWidth }"
                  >
                    <button
                      [class]="getCircleClass(column, gene)"
                      [style]="getCircleStyle(column, gene)"
                      (click)="
                        detailsPanel.toggle(
                          $event,
                          getDetailsPanelData(column, gene)
                        )
                      "
                    >
                      <span></span>
                    </button>
                  </td>
                </tr>
              </ng-template>
            </p-table>

            <div
              *ngIf="searchTerm || hasSelectedFilters()"
              class="table-divider"
            >
              <div class="table-divider-inner">
                <div *ngIf="searchTerm">Matching Genes</div>
                <div *ngIf="!searchTerm">Filtered Genes</div>
                <div *ngIf="genesTable.filteredValue?.length">
                  <button
                    class="pin-all-button"
                    [ngClass]="{ disabled: pinnedCount >= maxPinnedCount }"
                    (click)="pinFilteredGenes()"
                    [pTooltip]="
                      pinnedCount >= maxPinnedCount
                        ? 'You have already pinned the maximum number of genes (' +
                          maxPinnedCount +
                          '). You must unpin some genes before you can pin more.'
                        : 'Add all matching genes to Pinned list.'
                    "
                    tooltipPosition="top"
                    tooltipStyleClass="tooltip"
                  >
                    <svg
                      width="12"
                      height="17"
                      viewBox="0 0 12 17"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M7.65 1.7V5.95C7.65 6.902 7.9645 7.786 8.5 8.5H3.4C3.9525 7.769 4.25 6.885 4.25 5.95V1.7H7.65ZM10.2 0H1.7C1.2325 0 0.85 0.3825 0.85 0.85C0.85 1.3175 1.2325 1.7 1.7 1.7H2.55V5.95C2.55 7.361 1.411 8.5 0 8.5V10.2H5.0745V16.15L5.9245 17L6.7745 16.15V10.2H11.9V8.5C10.489 8.5 9.35 7.361 9.35 5.95V1.7H10.2C10.6675 1.7 11.05 1.3175 11.05 0.85C11.05 0.3825 10.6675 0 10.2 0Z"
                        fill="currentColor"
                      />
                    </svg>
                    Pin All
                  </button>
                </div>
              </div>
            </div>
            <div
              *ngIf="!searchTerm && !hasSelectedFilters() && pinnedCount > 0"
              class="table-divider"
            >
              <div class="table-divider-inner">
                <div>All Genes</div>
              </div>
            </div>
            <p-table
              #genesTable
              [value]="genes"
              [globalFilterFields]="['pinned']"
              [paginator]="true"
              [rows]="10"
              [showCurrentPageReport]="true"
              currentPageReportTemplate="{first}-{last} of {totalRecords}"
              responsiveLayout="scroll"
              (sortFunction)="sortCallback($event)"
              [customSort]="true"
            >
              <ng-template pTemplate="emptymessage" let-gene>
                <div class="no-results">No results founds....</div>
              </ng-template>

              <ng-template pTemplate="body" let-gene>
                <tr>
                  <td>
                    <div class="gene-controls">
                      <div>
                        {{ gene.hgnc_symbol || gene.ensembl_gene_id }}
                        <ng-container *ngIf="gene.uniprotid">
                          ({{ gene.uniprotid }})
                        </ng-container>
                      </div>
                      <div>
                        <button
                          (click)="pinGene(gene)"
                          [ngClass]="{
                            disabled: pinnedCount >= maxPinnedCount
                          }"
                          [pTooltip]="
                            pinnedCount >= maxPinnedCount
                              ? 'You have already pinned the maximum number of genes (' +
                                maxPinnedCount +
                                '). You must unpin some genes before you can pin more.'
                              : 'Pin this gene to the top of the list'
                          "
                          tooltipPosition="top"
                          tooltipStyleClass="tooltip"
                        >
                          <svg
                            width="12"
                            height="17"
                            viewBox="0 0 12 17"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path
                              d="M7.65 1.7V5.95C7.65 6.902 7.9645 7.786 8.5 8.5H3.4C3.9525 7.769 4.25 6.885 4.25 5.95V1.7H7.65ZM10.2 0H1.7C1.2325 0 0.85 0.3825 0.85 0.85C0.85 1.3175 1.2325 1.7 1.7 1.7H2.55V5.95C2.55 7.361 1.411 8.5 0 8.5V10.2H5.0745V16.15L5.9245 17L6.7745 16.15V10.2H11.9V8.5C10.489 8.5 9.35 7.361 9.35 5.95V1.7H10.2C10.6675 1.7 11.05 1.3175 11.05 0.85C11.05 0.3825 10.6675 0 10.2 0Z"
                              fill="white"
                            />
                          </svg>
                        </button>
                      </div>
                      <div>
                        <button
                          (click)="navigateToGene(gene)"
                          pTooltip="Open gene details page"
                          tooltipPosition="top"
                          tooltipStyleClass="tooltip"
                        >
                          <svg
                            width="15"
                            height="15"
                            viewBox="0 0 15 15"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path
                              d="M13.3333 13.3333H1.66667V1.66667H7.5V0H1.66667C0.741667 0 0 0.75 0 1.66667V13.3333C0 14.25 0.741667 15 1.66667 15H13.3333C14.25 15 15 14.25 15 13.3333V7.5H13.3333V13.3333ZM9.16667 0V1.66667H12.1583L3.96667 9.85833L5.14167 11.0333L13.3333 2.84167V5.83333H15V0H9.16667Z"
                              fill="white"
                            />
                          </svg>
                        </button>
                      </div>
                    </div>
                  </td>
                  <td
                    *ngFor="let column of columns"
                    [style]="{ width: columnWidth }"
                  >
                    <button
                      [class]="getCircleClass(column, gene)"
                      [style]="getCircleStyle(column, gene)"
                      (click)="
                        detailsPanel.toggle(
                          $event,
                          getDetailsPanelData(column, gene)
                        )
                      "
                    >
                      <span></span>
                    </button>
                  </td>
                </tr>
              </ng-template>
            </p-table>

            <div class="gct-help-links">
              <div class="gct-help-links-inner">
                <div>
                  <a class="gct-help-link" (click)="legendPanel.toggle()"
                    >Legend</a
                  >
                </div>
                <div>
                  <a class="gct-help-link" (click)="howToPanel.toggle()"
                    >Visualization Overview</a
                  >
                </div>
              </div>
            </div>

            <gene-comparison-tool-filter-panel
              #filterPanel
              [filters]="filters"
              (onChange)="setFilters($event)"
            ></gene-comparison-tool-filter-panel>
          </div>
        </div>
      </div>
    </div>

    <gene-comparison-tool-details-panel
      #detailsPanel
    ></gene-comparison-tool-details-panel>
    <gene-comparison-tool-how-to-panel
      #howToPanel
    ></gene-comparison-tool-how-to-panel>
    <gene-comparison-tool-legend-panel
      #legendPanel
      (howToClick)="legendPanel.toggle(); howToPanel.toggle()"
    ></gene-comparison-tool-legend-panel>
  </div>
</div>
